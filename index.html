<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>My New Component</title>
	<link rel=icon href=./favicon.ico>

	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=5,user-scalable=yes" />
	<link href="my-new-component.css" rel="styleSheet" />
	<link href="demo/prism-tomorrow.min.css" rel="styleSheet" />
	<link href="demo/demo.css" rel="styleSheet" />
	<script src="my-new-component.js" type="module"></script>
	<script src="demo/prism.js" defer></script>
</head>

<body>
	<main>
		<h1>My New Component</h1>
		<h2>This is a component which does this and that</h2>
		<h3>Features list</h3>
		<ul>
			<li>First</li>
			<li>Second</li>
		</ul>
		<h2>Demo</h2>
		<section>
			<div class="my-new-component">
				Component instance
			</div>

			<div class="code">
				<pre class="language-markup"><code class="language-markup">&lt;div class="my-new-component"&gt;
	Component instance
&lt;/div&gt;</code></pre>
			</div>

			<div class="component-options">
				<label>
					<input type="checkbox" data-class="my-new-component--variant" /><span></span> Variant</label>
			</div>

		</section>

	</main>
	<aside>

		<h2>Source</h2>

		<ul>
			<li><a href="https://www.npmjs.com/package/my-new-component">npm i --save-dev my-new-component</a></li>
			<li><a href="https://github.com/radogado/my-new-component">GitHub</a></li>
			<li><a href="my-new-component.scss">SCSS source</a></li>
			<li><a href="my-new-component.js">JS source</a></li>
			<li><a href="my-new-component.min.css">Minified CSS</a></li>
			<li><a href="my-new-component.min.js">Minified JS</a></li>
		</ul>


	</aside>

	<script>
		function copyButton(el, target, echo) {
			el.addEventListener("click", (event) => {
				window.getSelection().removeAllRanges(); // Clear previous clipboard
				var range = document.createRange();
				range.selectNode(target);
				window.getSelection().addRange(range);

				try {
					document.execCommand("copy");
				} catch (err) {}
			});
		}

		document.querySelectorAll(".code").forEach(function(el) {
			el.insertAdjacentHTML("beforeend", "<button class='n-btn' type='button'>Copy</button>");
			copyButton(el.querySelector("button"), el.querySelector("pre"));
		});

		["css", "js"].forEach((extension) => {
			fetch(`my-new-component.min.${extension}.size`)
				.then((response) => response.text())
				.then((text) => {
					document.querySelectorAll(`[href="my-new-component.min.${extension}"]`).forEach(el => {
						el.dataset.size = `${parseFloat(text / 1024).toFixed(1)} KB`
					})
				});
		});

		fetch(`package.json`)
			.then((response) => response.json())
			.then((text) => {
				document.querySelector("h1").dataset.version = text.version.split(".")[0] + "." + text.version.split(".")[1];
			});

		document.querySelectorAll(".component-options input").forEach((el) => {
			el.onchange = (e) => {
				let el = e.target;
				let component = el.closest('section').querySelector(".my-new-component");
				let snippet = false;
				[...el.closest('section').querySelectorAll("code .attr-value")].forEach((el) => {
					if (!snippet && el.childNodes[2].textContent.match(/my-new-component/) && el.previousElementSibling.textContent.match(/class/)) {
						snippet = el.childNodes[2];
					}
				});
				if (el.checked) {
					component.classList.add(el.dataset.class);
					snippet.textContent += ` ${el.dataset.class}`;
				} else {
					component.classList.remove(el.dataset.class);
					snippet.textContent = snippet.textContent.replace(` ${el.dataset.class}`, "").trim();
				}
			};
		});
	</script>
</body>

</html>